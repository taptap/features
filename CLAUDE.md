# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a DevContainer Features monorepo for the TapTap team that provides standardized development environment configurations. Features are published to GitHub Container Registry at `ghcr.io/taptap/features/*`.

## Key Commands

### Development & Testing

```bash
# Prerequisites
bun add -g @devcontainers/cli

# Validate feature metadata
devcontainer features validate src/<feature-name>

# Test single feature
devcontainer features test --features src/git-config

# Test all features
devcontainer features test --features src

# Test specific scenarios only
devcontainer features test --features src/git-config --skip-autogenerated

# Run tests for a specific Linux distribution
devcontainer features test --features src/git-config --base-image ubuntu:focal
```

### Publishing (requires permissions)

```bash
devcontainer features publish src --namespace ghcr.io/taptap/features
```

## Architecture & Conventions

### Feature Structure

Each feature in `src/` must contain:

- `devcontainer-feature.json` - Metadata defining the feature
- `install.sh` - Installation script (must be executable: `chmod +x`)
- `NOTES.md` - Additional documentation (README.md is auto-generated)

### Testing Structure

Each feature in `test/<feature-name>/` should have:

- `test.sh` - Default test script using `dev-container-features-test-lib`
- `scenarios.json` - Test scenarios for different OS distributions
- Additional `<scenario-name>.sh` scripts for specific scenario tests

### Installation Pattern

Features follow this general pattern (see `src/git-config/install.sh`):

1. Remove existing system packages to avoid conflicts
2. Download and execute official devcontainer feature installers
3. Apply organization-specific configurations
4. Set up system-level config files

### CI/CD Workflows

- **test.yml**: Validates and tests all features on PR/push
- **release.yml**: Auto-publishes to registry and generates documentation
- **generate-docs.yml**: Creates PRs with updated README files

### Documentation

- Feature README files are auto-generated from `devcontainer-feature.json` + `NOTES.md`
- Do not manually create or edit `src/*/README.md` files
- Add supplementary documentation to `NOTES.md` in each feature directory

## Feature-Specific Notes

### git-config

Configures organization-wide Git settings by:

- Installing latest Git via official devcontainer feature
- Applying settings from `system.gitconfig.txt` line by line
- Setting up global gitignore from `system.gitignore.txt`
- Supporting different package managers (apt, yum, apk)

Configuration files use a simple text format where each line is passed as arguments to `git config --system`.
